<%
/* ===== Defaults (safe fallbacks) ===== */
const defaults = {
  // Agency / producer
  producerName: "All Access Ins, dba Commercial Insurance Direct LLC",
  producerAddress1: "9200 W Cross Drive #515",
  producerAddress2: "Littleton, CO 80123",
  producerContact: "Rick Cline",
  producerEmail: "quote@barinsurancedirect.com",
  agencyCustomerId: "",

  // Policy / meta
  date: "",
  effective_date: "",
  carrier: "",
  naicCode: "",
  policyNumber: "",

  // Named insured + premises address
  applicant_name: "",
  premises_name: "",
  premise_address: "",
  premise_city: "",
  premise_state: "",
  premise_zip: "",
  bldgDescription: "",
  premisesNumber: "1",
  buildingNumber: "",

  // Subject of Insurance amounts
  business_personal_property: "",
  building_quote: "",

  // Additional coverages / options (key mapped fields)
  construction_type: "",
  number_of_stories: "",
  year_built: "",
  square_footage: "",
  automatic_sprinkler: "",   // percent or Y/N – we print raw

  // Additional Interests (first one shown; same pattern as 125/126)
  interests: [
    // { type:"ADDITIONAL_INSURED|LOSS_PAYEE|MORTGAGEE|LIENHOLDER|LENDERS_LOSS", name:"", address:"", city:"", state:"", zip:"", rank:"", loanNumber:"", itemType:"LOCATION|BUILDING|VEHICLE|BOAT", itemDescription:"" }
  ],

  remarks: ""
};

const data = Object.assign({}, defaults, (typeof formData === "object" && formData) || {});

/* ===== Helpers (consistent with 125/126) ===== */
const yes = (v) => ["yes","true","1","on","checked","y"].includes(String(v ?? "").toLowerCase()) || v === true || v === 1;
const yn  = (v) => v===""||v===null||v===undefined ? "" : (yes(v) ? "Y" : "N");
const money = (v) => {
  if (v===null || v===undefined || v==="") return "";
  const n = Number(String(v).replace(/[^0-9.-]/g,""));
  if (Number.isNaN(n)) return String(v);
  return n.toLocaleString("en-US", { minimumFractionDigits: 0, maximumFractionDigits: 0 });
};
const moneyUSD = (v) => money(v);
const formatDate = (d) => {
  try {
    if (!d) return "";
    const dt = new Date(d);
    if (Number.isNaN(dt.getTime())) return String(d);
    const mm = String(dt.getMonth()+1).padStart(2,"0");
    const dd = String(dt.getDate()).padStart(2,"0");
    const yyyy = dt.getFullYear();
    return `${mm}/${dd}/${yyyy}`;
  } catch { return String(d ?? ""); }
};
%>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>ACORD 140 - Property Section</title>
  <style>
    @media print { @page { margin: 0.25in; size: letter; } .page{page-break-after:always} .page:last-child{page-break-after:auto} }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial, sans-serif; font-size:8pt; line-height:1.1; color:#000; background:#fff}
    .page{width:100%; min-height:10.5in; padding:0.125in; border:1px solid #ccc; position:relative}
    .headerbar{display:flex; border:2px solid #000; background:#fff; margin-bottom:2px; align-items:center; height:40px}
    .headerbar .acord, .headerbar .formno{background:#000;color:#fff;font-weight:bold;font-size:16pt;width:60px;display:flex;align-items:center;justify-content:center;height:100%}
    .headerbar .acord{width:80px}
    .headerbar .title{flex:1; font-weight:bold; font-size:12pt; text-align:center; padding:0 10px}
    .subbar{background:#000;color:#fff;font-weight:bold;font-size:9pt;padding:3px 8px;margin:2px 0}
    .block{border:1px solid #000; margin-bottom:2px}
    .row{display:flex; border-bottom:1px solid #000; min-height:18px}
    .row:last-child{border-bottom:none}
    .cell{border-right:1px solid #000; padding:1px 3px; display:flex; align-items:center; overflow-wrap:break-word}
    .cell:last-child{border-right:none}
    .cell.label{background:#f0f0f0; font-weight:bold; font-size:6.5pt}
    .cell.center{text-align:center; justify-content:center}
    .cell.right{text-align:right; justify-content:flex-end}
    .cell.wrap{flex-wrap:wrap; align-items:flex-start}
    .small{font-size:7pt}
    .legal{font-size:6pt; line-height:1.2}
    .w5{width:5%}.w7{width:7%}.w8{width:8%}.w10{width:10%}.w12{width:12%}.w15{width:15%}.w18{width:18%}.w20{width:20%}.w22{width:22%}.w25{width:25%}.w30{width:30%}.w33{width:33%}.w35{width:35%}.w40{width:40%}.w45{width:45%}.w50{width:50%}.w55{width:55%}.w60{width:60%}.w65{width:65%}.w70{width:70%}.w75{width:75%}.w80{width:80%}.w85{width:85%}.w90{width:90%}.w95{width:95%}.w100{width:100%}
    .check{display:inline-block;width:10px;height:10px;border:1px solid #000;text-align:center;line-height:8px;font-size:8pt;margin-right:5px;vertical-align:middle}
    .check-xs{width:8px;height:8px;line-height:6px;font-size:6pt;margin-right:3px}
    .footnote{position:absolute; bottom:0.125in; left:0.125in; right:0.125in; font-size:6pt; border-top:1px solid #000; padding-top:2px; text-align:center}
    @media screen {.page{margin-bottom:20px; box-shadow:0 0 10px rgba(0,0,0,.1)}}
  </style>
</head>
<body>

<!-- ====================== PAGE 1 ====================== -->
<div class="page">
  <div class="headerbar">
    <div class="acord">ACORD</div>
    <div class="title">PROPERTY SECTION</div>
    <div class="formno">140</div>
  </div>

  <!-- NAMED INSURED / POLICY HEADER -->
  <div class="subbar">NAMED INSURED(S)</div>
  <div class="block">
    <div class="row">
      <div class="cell label w20">NAMED INSURED(S)</div>
      <div class="cell w40 wrap"><%= data.applicant_name || data.premises_name || "" %></div>
      <div class="cell label w10">CARRIER</div>
      <div class="cell w10"><%= data.carrier || "" %></div>
      <div class="cell label w10">NAIC CODE</div>
      <div class="cell w10"><%= data.naicCode || "" %></div>
    </div>
    <div class="row">
      <div class="cell label w20">POLICY NUMBER</div>
      <div class="cell w20"><%= data.policyNumber || "" %></div>
      <div class="cell label w20">EFFECTIVE DATE</div>
      <div class="cell w20"><%= formatDate(data.effective_date) %></div>
      <div class="cell label w10">DATE (MM/DD/YYYY)</div>
      <div class="cell w10"><%= formatDate(data.date) %></div>
    </div>
  </div>

  <!-- PREMISES INFORMATION -->
  <div class="subbar">PREMISES INFORMATION</div>
  <div class="block">
    <div class="row">
      <div class="cell label w10">PREMISES #</div>
      <div class="cell w10 center"><%= data.premisesNumber || "1" %></div>
      <div class="cell label w10">BUILDING #</div>
      <div class="cell w10 center"><%= data.buildingNumber || "" %></div>
      <div class="cell label w15">STREET ADDRESS</div>
      <div class="cell w45 wrap"><%= data.premise_address || "" %></div>
    </div>
    <div class="row">
      <div class="cell label w10">CITY</div>
      <div class="cell w20"><%= data.premise_city || "" %></div>
      <div class="cell label w10">STATE</div>
      <div class="cell w10"><%= data.premise_state || "" %></div>
      <div class="cell label w10">ZIP</div>
      <div class="cell w10"><%= data.premise_zip || "" %></div>
      <div class="cell label w10">BLDG DESCRIPTION</div>
      <div class="cell w20 wrap"><%= data.bldgDescription || "" %></div>
    </div>
  </div>

  <!-- SUBJECT OF INSURANCE -->
  <div class="subbar">SUBJECT OF INSURANCE</div>
  <div class="block">
    <div class="row">
      <div class="cell label w40">SUBJECT OF INSURANCE</div>
      <div class="cell label w30 right">AMOUNT</div>
      <div class="cell label w30 right">DED</div>
    </div>

    <!-- Business Personal Property -->
    <div class="row">
      <div class="cell w40">Business Personal Property</div>
      <div class="cell w30 right">$<%= moneyUSD(data.business_personal_property) %></div>
      <div class="cell w30 right">$2,500</div>
    </div>

    <!-- Building Quote -->
    <div class="row">
      <div class="cell w40">Building Quote</div>
      <div class="cell w30 right">$<%= moneyUSD(data.building_quote) %></div>
      <div class="cell w30 right"></div>
    </div>
  </div>

  <!-- ADDITIONAL COVERAGES / OPTIONS / RATING INFO -->
  <div class="subbar">ADDITIONAL COVERAGES, OPTIONS, RESTRICTIONS, ENDORSEMENTS AND RATING INFORMATION</div>
  <div class="block">
    <div class="row">
      <div class="cell label w18">CONSTRUCTION TYPE</div>
      <div class="cell w20"><%= data.construction_type || "" %></div>
      <div class="cell label w12"># STORIES</div>
      <div class="cell w10 right"><%= data.number_of_stories || "" %></div>
      <div class="cell label w12">YR BUILT</div>
      <div class="cell w10 right"><%= data.year_built || "" %></div>
      <div class="cell label w12">TOTAL AREA (SF)</div>
      <div class="cell w10 right"><%= data.square_footage || "" %></div>
    </div>
    <div class="row">
      <div class="cell label w18">% SPRINK</div>
      <div class="cell w20"><%= data.automatic_sprinkler || "" %></div>
      <div class="cell w62"></div>
    </div>
  </div>

  <div class="footnote">
    ACORD 140 (2025/03) &nbsp;&nbsp;&nbsp; Page 1 of 2 &nbsp;&nbsp;&nbsp; © ACORD CORPORATION. All rights reserved.
  </div>
</div>

<!-- ====================== PAGE 2 ====================== -->
<div class="page">
  <div class="headerbar">
    <div class="acord">ACORD</div>
    <div class="title">PROPERTY SECTION</div>
    <div class="formno">140</div>
  </div>

  <!-- ADDITIONAL INTEREST / CERTIFICATE RECIPIENT -->
  <div class="subbar">ADDITIONAL INTEREST / CERTIFICATE RECIPIENT</div>
  <div class="block">
    <div class="row">
      <div class="cell label w15">TYPE</div>
      <div class="cell w85">
        <span class="check"><%= ((data.interests?.[0]?.type || "").toUpperCase()==="ADDITIONAL_INSURED") ? "X" : "" %></span> ADDITIONAL INSURED
        <span class="check"><%= ((data.interests?.[0]?.type || "").toUpperCase()==="LOSS_PAYEE") ? "X" : "" %></span> LOSS PAYEE
        <span class="check"><%= ((data.interests?.[0]?.type || "").toUpperCase()==="MORTGAGEE") ? "X" : "" %></span> MORTGAGEE
        <span class="check"><%= ((data.interests?.[0]?.type || "").toUpperCase()==="LIENHOLDER") ? "X" : "" %></span> LIENHOLDER
        <span class="check"><%= ((data.interests?.[0]?.type || "").toUpperCase()==="LENDERS_LOSS") ? "X" : "" %></span> LENDER'S LOSS PAYABLE
      </div>
    </div>
    <div class="row">
      <div class="cell label w25">NAME AND ADDRESS</div>
      <div class="cell w35 wrap">
        <%= data.interests?.[0]?.name || "" %><br/>
        <%= [data.interests?.[0]?.address, data.interests?.[0]?.city, data.interests?.[0]?.state, data.interests?.[0]?.zip].filter(Boolean).join(", ") %>
      </div>
      <div class="cell label w15">RANK</div>
      <div class="cell w10"><%= data.interests?.[0]?.rank || "" %></div>
      <div class="cell label w15">REFERENCE / LOAN #</div>
      <div class="cell w10"><%= data.interests?.[0]?.loanNumber || "" %></div>
    </div>
    <div class="row">
      <div class="cell label w10">ITEM</div>
      <div class="cell w45">
        <span class="check"><%= ((data.interests?.[0]?.itemType || "").toUpperCase()==="LOCATION") ? "X" : "" %></span> LOCATION
        <span class="check"><%= ((data.interests?.[0]?.itemType || "").toUpperCase()==="BUILDING") ? "X" : "" %></span> BUILDING
        <span class="check"><%= ((data.interests?.[0]?.itemType || "").toUpperCase()==="VEHICLE") ? "X" : "" %></span> VEHICLE
        <span class="check"><%= ((data.interests?.[0]?.itemType || "").toUpperCase()==="BOAT") ? "X" : "" %></span> BOAT
      </div>
      <div class="cell label w20">ITEM DESCRIPTION</div>
      <div class="cell w25 wrap"><%= data.interests?.[0]?.itemDescription || "" %></div>
    </div>
  </div>

  <!-- REMARKS -->
  <div class="subbar">REMARKS (ACORD 101 MAY BE ATTACHED IF MORE SPACE IS REQUIRED)</div>
  <div class="block">
    <div class="row">
      <div class="cell w100 wrap" style="min-height:70px;"><%= data.remarks || "" %></div>
    </div>
  </div>

  <div class="footnote">
    ACORD 140 (2025/03) &nbsp;&nbsp;&nbsp; Page 2 of 2 &nbsp;&nbsp;&nbsp; © ACORD CORPORATION. All rights reserved.
  </div>
</div>

</body>
</html>

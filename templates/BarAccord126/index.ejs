<%
/* ===== Helpers & Defaults (reusing your 125 model) ===== */
const defaults = {
  // Dates / transaction
  date: "09/11/2025",
  effectiveDate: "09/11/2025",

  // ACORD 126 â€” coverage toggles
  gl_form: "OCCURRENCE", // "OCCURRENCE" | "CLAIMS_MADE"
  ownersContractorsProtective: false,

  // Limits
  limit_generalAggregate: "2,000,000",
  limit_productsAgg: "2,000,000",
  limit_personalAdvInjury: "1,000,000",
  limit_eachOccurrence: "1,000,000",
  limit_damageToPremises: "",
  limit_medicalExpense: "",
  limit_employeeBenefits: "",

  // Deductibles
  deductible_bodilyInjury: "",
  deductible_propertyDamage: "",

  // UM/UIM (WI note)
  wi_um_uim_available: false,
  wi_medpay_available: false,

  // Schedule of Hazards
  hazards: [],

  // Employee Benefits Liability (EBL)
  ebl_deductiblePerClaim: "",
  ebl_numEmployees: "",
  ebl_numEmployeesCovered: "",
  ebl_retroDate: "",

  // Claims Made (if gl_form === "CLAIMS_MADE")
  cm_proposedRetroDate: "",
  cm_entryDateUninterrupted: "",
  cm_priorExclusions: false,
  cm_tailPurchased: false,
  cm_explainYes: "",

  // Products / Completed Ops (table of products)
  products: [],
  prod_installServiceDemo: false,
  prod_foreignProducts: false,
  prod_rndOrNewProd: false,
  prod_guaranteesWarrantiesHoldHarmless: false,
  prod_aircraftSpace: false,
  prod_recalledDiscontinuedChanged: false,
  prod_privateLabelRepack: false,
  prod_underOthersLabel: false,
  prod_vendorsCoverage: false,
  prod_sellToOtherNamedInsureds: false,

  // Contractors block
  c_drawPlansDesigns: false,
  c_blastingExplosives: false,
  c_excavationTunneling: false,
  c_subsWithoutCOI: false,
  c_subsLowerLimits: false,
  c_leaseEquipToOthers: false,
  c_paidToSubs: "",
  c_percentSubcontracted: "",
  c_fullTimeStaff: "",
  c_partTimeStaff: "",
  c_typeOfWorkSubcontracted: "",

  // General information (Page 3 style)
  gi_medicalFacilities: false,
  gi_radioactive: false,
  gi_hazardousMaterials: false,
  gi_opsSoldAcquiredDiscontinued5yrs: false,
  gi_watercraftDocksFloats: false,
  gi_parkingFacilities: false,
  gi_parkingFee: false,
  gi_recreationFacilities: false,
  gi_lodgingOperations: false,
  gi_lodging_numApts: "",
  gi_lodging_totalAptArea: "",
  gi_lodging_otherDesc: "",
  gi_pool_inGround: false,
  gi_pool_aboveGround: false,
  gi_pool_divingBoard: false,
  gi_pool_slide: false,
  gi_pool_approvedFence: false,
  gi_pool_lifeGuard: false,
  gi_pool_limitedAccess: false,
  gi_socialEvents: false,
  gi_athleticTeams: false,
  gi_athletic_over18: false,
  gi_athletic_13to18: false,
  gi_athletic_12under: false,
  gi_athletic_contactSportOver18: false,
  gi_athletic_contactSport13to18: false,
  gi_athletic_contactSport12under: false,
  gi_athletic_extentOver18: "",
  gi_athletic_extent13to18: "",
  gi_athletic_extent12under: "",
  gi_structuralAlterations: false,
  gi_demolitionExposure: false,
  gi_rentLoanEquipment: false,
  gi_rentLoan_smallTools: false,
  gi_rentLoan_largeEquipment: false,
  gi_rentLoan_instrSmallTools: false,
  gi_rentLoan_instrLargeEquipment: false,
  gi_crimes3yrs: false,
  gi_safetySecurityPolicy: false,
  gi_promoLiteratureSafetyClaims: false,
  gi_jointVentures: false,
  gi_laborInterchange: false,
  gi_dayCareOperated: false,
  gi_wcLeaseTo: false,
  gi_wcLeaseFrom: false,
  gi_wcLeaseTo_hasWC: false,
  gi_wcLeaseFrom_hasWC: false,

  // Additional Interest / Certificate recipients
  interests: [],

  // Applicant (optional)
  applicant_name: "",
  applicant_mailing_address1: "",
  applicant_city: "",
  applicant_state: "",
  applicant_zip: "",

  agencyCustomerId: "",
};

const data = Object.assign({}, defaults, (typeof formData === "object" && formData) || {});

const yes = (v) => ["yes","true","1","on","checked","y"].includes(String(v ?? "").toLowerCase()) || v === true || v === 1;
const yn = (v) => yes(v) ? "Y" : (v === false || String(v).toLowerCase() === "n" ? "N" : "");
const money = (v) => {
  if (v === null || v === undefined || v === "") return "";
  const n = Number(v); if (Number.isNaN(n)) return String(v);
  return n.toLocaleString("en-US", { minimumFractionDigits: 0, maximumFractionDigits: 0 });
};
const moneyUSD = (v) => money(v);
const formatDate = (d) => {
  try {
    if (!d) return "";
    const dt = new Date(d);
    if (Number.isNaN(dt.getTime())) return String(d);
    const mm = String(dt.getMonth()+1).padStart(2,"0");
    const dd = String(dt.getDate()).padStart(2,"0");
    const yyyy = dt.getFullYear();
    return `${mm}/${dd}/${yyyy}`;
  } catch { return String(d ?? ""); }
};
%>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>ACORD 126 - Commercial General Liability Section</title>
  <style>
    /* ===== Shared layout from your 125 template ===== */
    @media print {
      @page { margin: 0.25in; size: letter; }
      .page { page-break-after: always; }
      .page:last-child { page-break-after: auto; }
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; font-size: 8pt; line-height: 1.1; background: #fff; color: #000; }
    .page { width: 100%; min-height: 10.5in; padding: 0.125in; border: 1px solid #ccc; position: relative; }
    .headerbar { display:flex; border:2px solid #000; background:#fff; margin-bottom: 2px; align-items:center; height:40px; }
    .headerbar .acord, .headerbar .formno { background:#000; color:#fff; font-weight:bold; font-size:16pt; width:60px; text-align:center; height:100%; display:flex; align-items:center; justify-content:center; }
    .headerbar .acord { width:80px; }
    .headerbar .title { flex:1; font-weight:bold; font-size:12pt; text-align:center; padding:0 10px; }
    .subbar { background:#000; color:#fff; font-weight:bold; font-size:9pt; padding:3px 8px; margin:2px 0; text-align:left; }
    .block { border:1px solid #000; margin-bottom:2px; }
    .row { display:flex; border-bottom:1px solid #000; min-height:18px; }
    .row:last-child { border-bottom:none; }
    .cell { border-right:1px solid #000; padding:1px 3px; display:flex; align-items:center; overflow-wrap:break-word; }
    .cell:last-child { border-right:none; }
    .cell.label { background:#f0f0f0; font-weight:bold; font-size:6.5pt; }
    .cell.center { justify-content:center; text-align:center; }
    .cell.right { justify-content:flex-end; text-align:right; }
    .cell.wrap { flex-wrap:wrap; align-items:flex-start; }
    .cell.small { font-size:7pt; }
    .cell.legal { font-size:6pt; line-height:1.2; }
    .w5{width:5%}.w7{width:7%}.w8{width:8%}.w10{width:10%}.w12{width:12%}.w15{width:15%}.w18{width:18%}.w20{width:20%}.w22{width:22%}.w25{width:25%}.w28{width:28%}.w30{width:30%}.w35{width:35%}.w40{width:40%}.w45{width:45%}.w50{width:50%}.w55{width:55%}.w60{width:60%}.w65{width:65%}.w70{width:70%}.w75{width:75%}.w80{width:80%}.w85{width:85%}.w90{width:90%}.w95{width:95%}.w100{width:100%}
    .check { display:inline-block; width:10px; height:10px; border:1px solid #000; text-align:center; line-height:8px; font-size:8pt; margin-right:5px; vertical-align:middle; }
    .check-xs { width:8px; height:8px; font-size:6pt; line-height:6px; }
    .checkbox { display:inline-block; width:8px; height:8px; border:1px solid #000; text-align:center; line-height:6px; font-size:6pt; margin-right:3px; vertical-align:middle; }
    .ck { display:inline-block; margin-right:10px; white-space:nowrap; }
    .footnote { position:absolute; bottom:0.125in; left:0.125in; right:0.125in; font-size:6pt; border-top:1px solid #000; padding-top:2px; text-align:center; }
    .no-break { page-break-inside: avoid; }
    @media screen {.page{margin-bottom:20px; box-shadow:0 0 10px rgba(0,0,0,.1)}}
  </style>
</head>
<body>

<!-- ====================== PAGE 1 ====================== -->
<div class="page">
  <div class="headerbar">
    <div class="acord">ACORD</div>
    <div class="title">COMMERCIAL GENERAL LIABILITY SECTION</div>
    <div class="formno">126</div>
  </div>

  <!-- APPLICANT -->
  <div class="subbar">APPLICANT</div>
  <div class="block">
    <div class="row">
      <div class="cell label w20">AGENCY</div>
      <div class="cell w40 wrap">
        <!-- LITERAL / HARD-CODED AGENCY BLOCK -->
        All Access Ins, dba Commercial Insurance Direct LLC<br/>
        9200 W Cross Drive #515<br/>
        Littleton, CO 80123
      </div>
      <div class="cell label w20">AGENCY CUSTOMER ID</div>
      <div class="cell w20"><%= data.agencyCustomerId || "" %></div>
    </div>
    <div class="row">
      <div class="cell label w20">APPLICANT / FIRST NAMED INSURED</div>
      <div class="cell w40 wrap">
        <%= data.applicant_name || "" %><br/>
        <%= data.applicant_mailing_address1 || "" %><br/>
        <%= data.applicant_city || "" %>, <%= data.applicant_state || "" %> <%= data.applicant_zip || "" %>
      </div>
      <div class="cell label w10">CARRIER</div>
      <div class="cell w10"></div>
      <div class="cell label w10">NAIC CODE</div>
      <div class="cell w10"></div>
    </div>
    <div class="row">
      <div class="cell label w20">POLICY NUMBER</div>
      <div class="cell w20"></div>
      <div class="cell label w20">EFFECTIVE DATE</div>
      <div class="cell w20"><%= data.effectiveDate %></div>
      <div class="cell label w10">DATE (MM/DD/YYYY)</div>
      <div class="cell w10"><%= data.date %></div>
    </div>
  </div>

  <!-- COVERAGE / LIMITS -->
  <div class="subbar">COVERAGE / LIMITS</div>
  <div class="block">
    <div class="row">
      <div class="cell label w25">COMMERCIAL GENERAL LIABILITY</div>
      <div class="cell w25">
        <span class="check"><%= data.gl_form === "OCCURRENCE" ? "X" : "" %></span> OCCURRENCE
      </div>
      <div class="cell w25">
        <span class="check"><%= data.gl_form === "CLAIMS_MADE" ? "X" : "" %></span> CLAIMS MADE
      </div>
      <div class="cell w25">
        <span class="check"><%= yes(data.ownersContractorsProtective) ? "X" : "" %></span> OWNER'S &amp; CONTRACTOR'S PROTECTIVE
      </div>
    </div>
    <div class="row">
      <div class="cell label w25">GENERAL AGGREGATE</div>
      <div class="cell w25 right">$<%= data.limit_generalAggregate %></div>
      <div class="cell label w25">EACH OCCURRENCE</div>
      <div class="cell w25 right">$<%= data.limit_eachOccurrence %></div>
    </div>
    <div class="row">
      <div class="cell label w25">PRODUCTS &amp; COMPLETED OPERATIONS AGGREGATE</div>
      <div class="cell w25 right">$<%= data.limit_productsAgg %></div>
      <div class="cell label w25">PERSONAL &amp; ADVERTISING INJURY</div>
      <div class="cell w25 right">$<%= data.limit_personalAdvInjury %></div>
    </div>
    <div class="row">
      <div class="cell label w25">DAMAGE TO RENTED PREMISES (each occurrence)</div>
      <div class="cell w25 right">$<%= data.limit_damageToPremises %></div>
      <div class="cell label w25">MEDICAL EXPENSE (any one person)</div>
      <div class="cell w25 right">$<%= data.limit_medicalExpense %></div>
    </div>
    <div class="row">
      <div class="cell label w25">EMPLOYEE BENEFITS</div>
      <div class="cell w25 right">$<%= data.limit_employeeBenefits %></div>
      <div class="cell label w25">OTHER</div>
      <div class="cell w25"></div>
    </div>

    <div class="row">
      <div class="cell label w20">DEDUCTIBLES</div>
      <div class="cell label w20 center">BODILY INJURY</div>
      <div class="cell w15 right">$<%= data.deductible_bodilyInjury %></div>
      <div class="cell label w20 center">PROPERTY DAMAGE</div>
      <div class="cell w25 right">$<%= data.deductible_propertyDamage %></div>
    </div>
  </div>

  <!-- WI UM/UIM & MED PAY AVAILABILITY NOTE -->
  <div class="block">
    <div class="row">
      <div class="cell w100 small">
        APPLICABLE ONLY IN WISCONSIN: IF NON-OWNED ONLY AUTO COVERAGE IS TO BE PROVIDED UNDER THE POLICY:<br/>
        1. UM / UIM COVERAGE&nbsp;&nbsp;<span class="check"><%= yes(data.wi_um_uim_available) ? "X" : "" %></span> IS &nbsp;&nbsp;&nbsp;<span class="check"><%= !yes(data.wi_um_uim_available) ? "X" : "" %></span> IS NOT AVAILABLE.
        &nbsp;&nbsp;&nbsp;2. MEDICAL PAYMENTS COVERAGE&nbsp;&nbsp;<span class="check"><%= yes(data.wi_medpay_available) ? "X" : "" %></span> IS &nbsp;&nbsp;&nbsp;<span class="check"><%= !yes(data.wi_medpay_available) ? "X" : "" %></span> IS NOT AVAILABLE.
      </div>
    </div>
  </div>

  <!-- SCHEDULE OF HAZARDS -->
  <div class="subbar">SCHEDULE OF HAZARDS (RATING AND PREMIUM BASIS)</div>
  <div class="block">
    <div class="row">
      <div class="cell label w5 center">LOC #</div>
      <div class="cell label w5 center">HAZ #</div>
      <div class="cell label w10 center">CLASS CODE</div>
      <div class="cell label w25 center">CLASSIFICATION DESCRIPTION</div>
      <div class="cell label w8 center">PREM BASIS<br/>(A,P,S,C,M,U,T)</div>
      <div class="cell label w7 center">EXPOSURE</div>
      <div class="cell label w5 center">TERR</div>
      <div class="cell label w8 center">RATE<br/>PREM/OPS</div>
      <div class="cell label w8 center">RATE<br/>PRODUCTS</div>
      <div class="cell label w9 center">PREMIUM<br/>PREM/OPS</div>
      <div class="cell label w10 center">PREMIUM<br/>PRODUCTS</div>
    </div>

    <% (Array.isArray(data.hazards)?data.hazards:[]).forEach(function(H){ %>
      <div class="row">
        <div class="cell w5 center"><%= H.loc || "" %></div>
        <div class="cell w5 center"><%= H.haz || "" %></div>
        <div class="cell w10 center"><%= H.classCode || "" %></div>
        <div class="cell w25 wrap"><%= H.classificationDescription || H.classDesc || "" %></div>
        <div class="cell w8 center"><%= H.premiumBasis || "" %></div>
        <div class="cell w7 right"><%= H.exposure || "" %></div>
        <div class="cell w5 center"><%= H.terr || H.territory || "" %></div>
        <div class="cell w8 right"><%= H.ratePremOps || "" %></div>
        <div class="cell w8 right"><%= H.rateProducts || "" %></div>
        <div class="cell w9 right"><%= moneyUSD(H.premiumPremOps) %></div>
        <div class="cell w10 right"><%= moneyUSD(H.premiumProducts) %></div>
      </div>
    <% }) %>
  </div>

  <div class="footnote">
    ACORD 126 (2025/03) &nbsp;&nbsp;&nbsp; Page 1 of 4 &nbsp;&nbsp;&nbsp; Â© 1993-2025 ACORD CORPORATION. All rights reserved.
  </div>
</div>

<!-- ====================== PAGE 2 ====================== -->
<div class="page">
  <div class="headerbar">
    <div class="acord">ACORD</div>
    <div class="title">COMMERCIAL GENERAL LIABILITY SECTION</div>
    <div class="formno">126</div>
  </div>

  <!-- EMPLOYEE BENEFITS LIABILITY -->
  <div class="subbar">EMPLOYEE BENEFITS LIABILITY</div>
  <div class="block">
    <div class="row">
      <div class="cell label w25">DEDUCTIBLE PER CLAIM</div>
      <div class="cell w25 right">$<%= data.ebl_deductiblePerClaim %></div>
      <div class="cell label w25">NUMBER OF EMPLOYEES</div>
      <div class="cell w25 right"><%= data.ebl_numEmployees %></div>
    </div>
    <div class="row">
      <div class="cell label w25">NUMBER OF EMPLOYEES COVERED BY EMPLOYEE BENEFITS PLANS</div>
      <div class="cell w25 right"><%= data.ebl_numEmployeesCovered %></div>
      <div class="cell label w25">RETROACTIVE DATE</div>
      <div class="cell w25"><%= data.ebl_retroDate %></div>
    </div>
  </div>

  <!-- CLAIMS MADE -->
  <div class="subbar">CLAIMS MADE (Complete if applicable)</div>
  <div class="block">
    <div class="row">
      <div class="cell label w25">PROPOSED RETROACTIVE DATE</div>
      <div class="cell w25"><%= data.cm_proposedRetroDate %></div>
      <div class="cell label w25">ENTRY DATE INTO UNINTERRUPTED CLAIMS MADE COVERAGE</div>
      <div class="cell w25"><%= data.cm_entryDateUninterrupted %></div>
    </div>
    <div class="row">
      <div class="cell label w70">HAS ANY PRODUCT, WORK, ACCIDENT, OR LOCATION BEEN EXCLUDED, UNINSURED OR SELF-INSURED FROM ANY PREVIOUS COVERAGE?</div>
      <div class="cell w5 center"><%= yn(data.cm_priorExclusions) %></div>
      <div class="cell label w20">WAS TAIL COVERAGE PURCHASED UNDER ANY PREVIOUS POLICY?</div>
      <div class="cell w5 center"><%= yn(data.cm_tailPurchased) %></div>
    </div>
    <div class="row">
      <div class="cell label w100">EXPLAIN ALL "YES" RESPONSES</div>
    </div>
    <div class="row">
      <div class="cell w100 wrap" style="min-height:40px;"><%= data.cm_explainYes || "" %></div>
    </div>
  </div>

  <!-- PRODUCTS / COMPLETED OPERATIONS -->
  <div class="subbar">PRODUCTS / COMPLETED OPERATIONS</div>
  <div class="block">
    <div class="row">
      <div class="cell label w20 center">PRODUCTS</div>
      <div class="cell label w15 center">ANNUAL GROSS SALES</div>
      <div class="cell label w10 center"># OF UNITS</div>
      <div class="cell label w10 center">TIME IN MARKET</div>
      <div class="cell label w10 center">INTENDED USE</div>
      <div class="cell label w10 center">LIFE EXPECTED</div>
      <div class="cell label w25 center">PRINCIPAL COMPONENTS</div>
    </div>
    <% (Array.isArray(data.products)?data.products:[]).forEach(function(P){ %>
      <div class="row">
        <div class="cell w20 wrap"><%= P.name || "" %></div>
        <div class="cell w15 right">$<%= moneyUSD(P.annualGrossSales) %></div>
        <div class="cell w10 right"><%= P.units || "" %></div>
        <div class="cell w10 center"><%= P.timeInMarket || "" %></div

<%
/* Defaults + data merge (helpers are injected from src/pdf.js) */
const defaults = { date: formatDate(), effectiveDate: formatDate() };
const data = Object.assign({}, defaults, formData || {});

/* ---- Additional Interest aggregator (1-up fields + array fallback) */
const aiBlocks = [];
function pushAI(name, addr, city, state, zip, types) {
  if (!name && !addr && !city && !state && !zip) return;
  aiBlocks.push({
    name: name || "",
    addressLine: join([addr, city, state, zip]) || "",
    types: types || {}
  });
}
// 1..5 (v1)
pushAI(data.ai_name_1, data.ai_address_1, data.ai_city_1, data.ai_state_1, data.ai_zip_1,
       { addl: data.ai_additional_insured,     loss: data.ai_loss_payee,     mort: data.ai_mortgagee,     lien: data.ai_lienholder });
pushAI(data.ai_name_2, data.ai_address_2, data.ai_city_2, data.ai_state_2, data.ai_zip_2,
       { addl: data.ai_additional_insured_2,   loss: data.ai_loss_payee_2,   mort: data.ai_mortgagee_2,   lien: data.ai_lienholder_2 });
pushAI(data.ai_name_3, data.ai_address_3, data.ai_city_3, data.ai_state_3, data.ai_zip_3,
       { addl: data.ai_additional_insured_3,   loss: data.ai_loss_payee_3,   mort: data.ai_mortgagee_3,   lien: data.ai_lienholder_3 });
pushAI(data.ai_name_4, data.ai_address_4, data.ai_city_4, data.ai_state_4, data.ai_zip_4,
       { addl: data.ai_additional_insured_4,   loss: data.ai_loss_payee_4,   mort: data.ai_mortgagee_4,   lien: data.ai_lienholder_4 });
pushAI(data.ai_name_5, data.ai_address_5, data.ai_city_5, data.ai_state_5, data.ai_zip_5,
       { addl: data.ai_additional_insured_5,   loss: data.ai_loss_payee_5,   mort: data.ai_mortgagee_5,   lien: data.ai_lienholder_5 });
// array (v2)
if (Array.isArray(data.additional_interests)) {
  data.additional_interests.forEach(it => {
    pushAI(it.name, it.address, it.city, it.state, it.zip,
      { addl: it.additional_insured, loss: it.loss_payee, mort: it.mortgagee, lien: it.lienholder });
  });
}
%>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>ACORD 126 – Commercial General Liability Section</title>
  <!-- Use the exact same CSS as ACORD 125 -->
  <style><%= styles %></style>
</head>
<body>

<!-- PAGE 1 -->
<div class="page">
  <!-- ACORD header (same structure as 125) -->
  <div class="headerbar">
    <div class="acord">ACORD</div>
    <div class="title">COMMERCIAL GENERAL LIABILITY SECTION</div>
    <div class="formno">126</div>
  </div>

  <!-- Applicant -->
  <div class="subbar">APPLICANT</div>
  <div class="block">
    <div class="row">
      <div class="cell label w20">NAME</div>
      <div class="cell w80 wrap"><%= data.applicant_name || data.named_insured || "" %></div>
    </div>
    <div class="row">
      <div class="cell label w20">PREMISES</div>
      <div class="cell w80 wrap">
        <%= join([data.premise_address, data.premise_city, data.premise_state, data.premise_zip]) %>
      </div>
    </div>
  </div>

  <!-- Exposures -->
  <div class="subbar">EXPOSURES</div>
  <div class="block">
    <div class="row">
      <div class="cell label w20">TOTAL SALES</div>
      <div class="cell w30 right">$<%= money(data.total_sales) %></div>
      <div class="cell label w20">ALCOHOL SALES</div>
      <div class="cell w30 right">$<%= money(data.alcohol_sales) %></div>
    </div>
    <div class="row">
      <div class="cell label w20">SQUARE FOOTAGE</div>
      <div class="cell w30 right"><%= data.square_footage || "" %></div>
      <div class="cell label w20">OCCUPANCY</div>
      <div class="cell w30"><%= data.occupancy || data.max_occupancy || "" %></div>
    </div>
  </div>

  <!-- Additional Interest -->
  <div class="subbar">ADDITIONAL INTEREST</div>
  <div class="block">
    <% if (aiBlocks.length) { %>
      <% aiBlocks.forEach(function(ai, idx){ %>
        <div class="row">
          <div class="cell label w10">TYPE</div>
          <div class="cell w40">
            <span class="check"><%= isYes(ai.types.addl) ? "X" : "" %></span> ADDITIONAL INSURED
            <span class="check"><%= isYes(ai.types.loss) ? "X" : "" %></span> LOSS PAYEE
            <span class="check"><%= isYes(ai.types.mort) ? "X" : "" %></span> MORTGAGEE
            <span class="check"><%= isYes(ai.types.lien) ? "X" : "" %></span> LIENHOLDER
          </div>
          <div class="cell label w15">NAME</div>
          <div class="cell w35 wrap"><%= ai.name %></div>
        </div>
        <div class="row" style="<%= idx<aiBlocks.length-1 ? 'border-top:2pt solid #000;' : '' %>">
          <div class="cell label w20">INTEREST NAME & ADDRESS</div>
          <div class="cell w80 wrap small"><%= ai.addressLine %></div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="row">
        <div class="cell w100" style="color:#000;">No additional interests provided.</div>
      </div>
    <% } %>
  </div>

  <!-- Remarks -->
  <div class="subbar">REMARKS</div>
  <div class="block">
    <div class="row no-break">
      <div class="cell w100 wrap small" style="min-height:48pt;"><%= data.remarks || "" %></div>
    </div>
  </div>

  <!-- Footer (optional, mimic 125 pattern if you want page callout) -->
  <div class="footnote">
    ACORD 126 (sample layout) &nbsp;&nbsp;&nbsp; Page 1 of 2 &nbsp;&nbsp;&nbsp; © ACORD
  </div>
</div>

<!-- PAGE 2 -->
<div class="page">
  <div class="headerbar">
    <div class="acord">ACORD</div>
    <div class="title">COMMERCIAL GENERAL LIABILITY SECTION</div>
    <div class="formno">126</div>
  </div>

  <!-- Signature -->
  <div class="subbar">SIGNATURE</div>
  <div class="block">
    <div class="row">
      <div class="cell label w25">APPLICANT’S SIGNATURE</div>
      <div class="cell w45" style="border-bottom:1pt solid #000;">&nbsp;</div>
      <div class="cell label w10">DATE</div>
      <div class="cell w20"><%= data.date %></div>
    </div>
    <div class="row">
      <div class="cell label w25">TITLE</div>
      <div class="cell w75">&nbsp;</div>
    </div>
  </div>

  <!-- Legal Notice -->
  <div class="subbar">LEGAL NOTICE</div>
  <div class="block">
    <div class="row">
      <div class="cell w100 legal wrap small">
        The undersigned authorized representative of the applicant declares that all statements are true and complete…
      </div>
    </div>
  </div>

  <div class="footnote">
    ACORD 126 (sample layout) &nbsp;&nbsp;&nbsp; Page 2 of 2 &nbsp;&nbsp;&nbsp; © ACORD
  </div>
</div>

</body>
</html>
